<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ポケモン検索</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .search-container {
            text-align: center;
            margin: 20px 0;
        }
        #searchInput {
            padding: 10px;
            font-size: 16px;
            width: 200px;
            border: 2px solid #3b4cca;
            border-radius: 5px;
        }
        #searchButton, #randomButton {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #3b4cca;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
        }
        #searchButton:hover, #randomButton:hover {
            background-color: #2a3899;
        }
        #result {
            text-align: center;
            margin-top: 20px;
        }
        .pokemon-card {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        .type-label {
            display: inline-block;
            padding: 3px 10px;
            margin: 2px;
            border-radius: 15px;
            color: white;
            font-size: 14px;
        }
        .evolution-chain {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        .evolution-card {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            min-width: 150px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .evolution-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .evolution-arrow {
            font-size: 24px;
            color: #3b4cca;
        }
        .current-pokemon {
            border: 3px solid #3b4cca;
        }
    </style>
</head>
<body>
    <div class="search-container">
        <h1>ポケモン検索</h1>
        <input type="text" id="searchInput" placeholder="図鑑番号（1-898）または名前を入力">
        <button id="searchButton">検索</button>
        <button id="randomButton">ランダム表示</button>
    </div>
    <div id="result"></div>

    <script>
        // タイプごとの背景色
        const typeColors = {
            normal: '#A8A878',
            fire: '#F08030',
            water: '#6890F0',
            electric: '#F8D030',
            grass: '#78C850',
            ice: '#98D8D8',
            fighting: '#C03028',
            poison: '#A040A0',
            ground: '#E0C068',
            flying: '#A890F0',
            psychic: '#F85888',
            bug: '#A8B820',
            rock: '#B8A038',
            ghost: '#705898',
            dragon: '#7038F8',
            dark: '#705848',
            steel: '#B8B8D0',
            fairy: '#EE99AC'
        };

        document.getElementById('searchButton').addEventListener('click', searchPokemon);
        document.getElementById('randomButton').addEventListener('click', getRandomPokemon);
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchPokemon();
            }
        });

        // ページ読み込み時にランダムポケモンを表示
        window.addEventListener('load', getRandomPokemon);

        function getRandomPokemon() {
            // ポケモンの最大数（第8世代まで）
            const maxPokemonId = 898;
            const randomId = Math.floor(Math.random() * maxPokemonId) + 1;
            fetchPokemon(randomId);
        }

        function searchPokemon() {
            const searchValue = document.getElementById('searchInput').value.toLowerCase().trim();
            const resultDiv = document.getElementById('result');
            
            if (!searchValue) {
                resultDiv.innerHTML = '<p>図鑑番号または名前を入力してください。</p>';
                return;
            }

            // 数字かどうかをチェック
            const pokedexNumber = parseInt(searchValue);
            if (!isNaN(pokedexNumber)) {
                // 有効な図鑑番号の範囲をチェック
                if (pokedexNumber >= 1 && pokedexNumber <= 898) {
                    fetchPokemon(pokedexNumber);
                } else {
                    resultDiv.innerHTML = '<p>図鑑番号は1から898の間で入力してください。</p>';
                }
            } else {
                // 名前での検索
                fetchPokemon(searchValue);
            }
        }

        function getTypeInJapanese(type) {
            const typeMap = {
                normal: 'ノーマル',
                fire: 'ほのお',
                water: 'みず',
                electric: 'でんき',
                grass: 'くさ',
                ice: 'こおり',
                fighting: 'かくとう',
                poison: 'どく',
                ground: 'じめん',
                flying: 'ひこう',
                psychic: 'エスパー',
                bug: 'むし',
                rock: 'いわ',
                ghost: 'ゴースト',
                dragon: 'ドラゴン',
                dark: 'あく',
                steel: 'はがね',
                fairy: 'フェアリー'
            };
            return typeMap[type] || type;
        }

        async function fetchPokemon(identifier) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>読み込み中...</p>';

            try {
                // ポケモンの基本情報を取得
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${identifier}`);
                const data = await response.json();

                // 種の情報（日本語名を含む）を取得
                const speciesResponse = await fetch(data.species.url);
                const speciesData = await speciesResponse.json();

                // 進化チェーンの情報を取得
                const evolutionResponse = await fetch(speciesData.evolution_chain.url);
                const evolutionData = await evolutionResponse.json();

                // 日本語の名前を取得
                const japaneseName = speciesData.names.find(name => name.language.name === 'ja')?.name || data.name;
                
                // 日本語のフレーバーテキストを取得
                const japaneseFlavorText = speciesData.flavor_text_entries
                    .find(entry => entry.language.name === 'ja')?.flavor_text.replace(/\n/g, ' ') || '';

                // タイプを日本語で表示し、色付きで表示
                const typeHtml = data.types.map(type => {
                    const typeName = type.type.name;
                    const backgroundColor = typeColors[typeName] || '#777';
                    return `<span class="type-label" style="background-color: ${backgroundColor}">${getTypeInJapanese(typeName)}</span>`;
                }).join(' ');

                // メインのポケモン情報を表示
                resultDiv.innerHTML = `
                    <div class="pokemon-card">
                        <h2>${japaneseName}</h2>
                        <img src="${data.sprites.front_default}" alt="${japaneseName}" style="width: 150px;">
                        <p>図鑑番号: ${data.id}</p>
                        <p>タイプ: ${typeHtml}</p>
                        <p>身長: ${data.height / 10}m</p>
                        <p>体重: ${data.weight / 10}kg</p>
                        <p style="font-style: italic;">${japaneseFlavorText}</p>
                    </div>
                    <div id="evolution-chain" class="evolution-chain">
                        <p>進化チェーン読み込み中...</p>
                    </div>
                `;

                // 進化チェーンを処理して表示
                const evolutionChain = [];
                let evoData = evolutionData.chain;
                
                // 進化チェーンを配列に変換
                while (evoData) {
                    evolutionChain.push({
                        name: evoData.species.name,
                        url: evoData.species.url
                    });
                    evoData = evoData.evolves_to[0]; // 最初の進化系統のみを考慮
                }

                // 進化チェーンの各ポケモンの情報を取得
                const evolutionPromises = evolutionChain.map(async (pokemon) => {
                    const speciesResponse = await fetch(pokemon.url);
                    const speciesData = await speciesResponse.json();
                    const pokemonResponse = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemon.name}`);
                    const pokemonData = await pokemonResponse.json();
                    
                    return {
                        name: speciesData.names.find(name => name.language.name === 'ja')?.name || pokemon.name,
                        image: pokemonData.sprites.front_default,
                        id: pokemonData.id,
                        searchName: pokemon.name // 検索用の英語名を追加
                    };
                });

                // 全ての進化形態の情報を取得して表示
                const evolutionResults = await Promise.all(evolutionPromises);
                const evolutionHtml = evolutionResults.map((pokemon, index) => {
                    const isCurrentPokemon = pokemon.id === data.id;
                    return `
                        ${index > 0 ? '<div class="evolution-arrow">→</div>' : ''}
                        <div class="evolution-card ${isCurrentPokemon ? 'current-pokemon' : ''}" 
                             onclick="fetchPokemon('${pokemon.searchName}')" 
                             title="クリックして${pokemon.name}の詳細を表示">
                            <img src="${pokemon.image}" alt="${pokemon.name}" style="width: 100px;">
                            <p>${pokemon.name}</p>
                        </div>
                    `;
                }).join('');

                document.getElementById('evolution-chain').innerHTML = evolutionHtml;

            } catch (error) {
                resultDiv.innerHTML = '<p>ポケモンが見つかりませんでした。正しい名前を入力してください。</p>';
            }
        }
    </script>
</body>
</html>